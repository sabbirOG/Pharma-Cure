<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaCure - Admin Panel</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo" data-lang="app-title">PharmaCure</h1>
                <nav class="nav">
                    <a href="index.html" class="nav-link" data-lang="nav-home">Home</a>
                    <a href="medicine.html" class="nav-link" data-lang="nav-medicine">Medicine Corner</a>
                    <a href="doctor.html" class="nav-link" data-lang="nav-doctor">Doctor Corner</a>
                    <a href="profile.html" class="nav-link" data-lang="nav-profile">Profile</a>
                    <button class="btn btn-secondary" onclick="auth.logout()" data-lang="btn-logout">Logout</button>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <div class="page-header">
                <h2 data-lang="admin-title">Admin Panel</h2>
                <p data-lang="admin-desc">Manage medicines, doctors, and appointments</p>
            </div>

            <!-- Dashboard Stats -->
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3 data-lang="stat-medicines">Total Medicines</h3>
                    <span id="total-medicines" class="stat-number">0</span>
                </div>
                <div class="stat-card">
                    <h3 data-lang="stat-doctors">Total Doctors</h3>
                    <span id="total-doctors" class="stat-number">0</span>
                </div>
                <div class="stat-card">
                    <h3 data-lang="stat-appointments">Today's Appointments</h3>
                    <span id="today-appointments" class="stat-number">0</span>
                </div>
                <div class="stat-card">
                    <h3 data-lang="stat-customers">Total Customers</h3>
                    <span id="total-customers" class="stat-number">0</span>
                </div>
            </div>

            <!-- Tabs -->
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="admin.showTab('medicines')" data-lang="tab-medicines">Medicines</button>
                <button class="tab-btn" onclick="admin.showTab('doctors')" data-lang="tab-doctors">Doctors</button>
                <button class="tab-btn" onclick="admin.showTab('appointments')" data-lang="tab-appointments">Appointments</button>
            </div>

            <!-- Medicines Tab -->
            <div id="medicines-tab" class="tab-content active">
                <div class="section-header">
                    <h3 data-lang="manage-medicines">Manage Medicines</h3>
                    <button class="btn btn-primary" onclick="admin.showMedicineModal()" data-lang="btn-add-medicine">Add Medicine</button>
                </div>
                <div id="medicines-list" class="admin-list">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>

            <!-- Doctors Tab -->
            <div id="doctors-tab" class="tab-content">
                <div class="section-header">
                    <h3 data-lang="manage-doctors">Manage Doctors</h3>
                    <button class="btn btn-primary" onclick="admin.showDoctorModal()" data-lang="btn-add-doctor">Add Doctor</button>
                </div>
                <div id="doctors-list" class="admin-list">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>

            <!-- Appointments Tab -->
            <div id="appointments-tab" class="tab-content">
                <div class="section-header">
                    <h3 data-lang="manage-appointments">Manage Appointments</h3>
                </div>
                <div id="appointments-list" class="admin-list">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p data-lang="footer-text">&copy; 2024 PharmaCure. All rights reserved.</p>
        </footer>
    </div>

    <!-- Medicine Modal -->
    <div id="medicine-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="medicine-modal-title" data-lang="add-medicine">Add Medicine</h3>
                <span class="close" onclick="admin.closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="medicine-form">
                    <input type="hidden" id="medicine-id" name="id">
                    
                    <div class="form-group">
                        <label data-lang="label-name">Name</label>
                        <input type="text" id="medicine-name" name="name" required>
                    </div>

                    <div class="form-group">
                        <label data-lang="label-category">Category</label>
                        <select id="medicine-category" name="category" required>
                            <option value="Pain Relief" data-lang="category-pain">Pain Relief</option>
                            <option value="Antibiotics" data-lang="category-antibiotics">Antibiotics</option>
                            <option value="Vitamins" data-lang="category-vitamins">Vitamins</option>
                            <option value="Cold & Flu" data-lang="category-cold">Cold & Flu</option>
                            <option value="Digestive" data-lang="category-digestive">Digestive</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label data-lang="label-price">Price (à§³)</label>
                        <input type="number" id="medicine-price" name="price" required min="0" step="0.01">
                    </div>

                    <div class="form-group">
                        <label data-lang="label-stock">Stock Quantity</label>
                        <input type="number" id="medicine-stock" name="stock" required min="0">
                    </div>

                    <div class="form-group">
                        <label data-lang="label-description">Description</label>
                        <textarea id="medicine-description" name="description" rows="3"></textarea>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="admin.closeModal()" data-lang="btn-cancel">Cancel</button>
                        <button type="submit" class="btn btn-primary" data-lang="btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Doctor Modal -->
    <div id="doctor-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="doctor-modal-title" data-lang="add-doctor">Add Doctor</h3>
                <span class="close" onclick="admin.closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="doctor-form">
                    <input type="hidden" id="doctor-id" name="id">
                    
                    <div class="form-group">
                        <label data-lang="label-name">Name</label>
                        <input type="text" id="doctor-name" name="name" required>
                    </div>

                    <div class="form-group">
                        <label data-lang="label-specialization">Specialization</label>
                        <input type="text" id="doctor-specialization" name="specialization" required>
                    </div>

                    <div class="form-group">
                        <label data-lang="label-experience">Experience (Years)</label>
                        <input type="number" id="doctor-experience" name="experience" required min="0">
                    </div>

                    <div class="form-group">
                        <label data-lang="label-phone">Phone</label>
                        <input type="tel" id="doctor-phone" name="phone" required>
                    </div>

                    <div class="form-group">
                        <label data-lang="label-photo">Photo (Base64)</label>
                        <input type="file" id="doctor-photo" name="photo" accept="image/*" onchange="admin.handlePhotoUpload(this)">
                    </div>

                    <div class="form-group">
                        <label data-lang="label-bio">Bio</label>
                        <textarea id="doctor-bio" name="bio" rows="3"></textarea>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="admin.closeModal()" data-lang="btn-cancel">Cancel</button>
                        <button type="submit" class="btn btn-primary" data-lang="btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Scripts -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/language.js"></script>
    <script src="assets/js/notifications.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication and admin role
            if (!auth.isAuthenticated()) {
                window.location.href = 'login.html';
                return;
            }

            const user = auth.getCurrentUser();
            if (user.role !== 'admin') {
                window.location.href = 'index.html';
                return;
            }

            // Load language
            language.init();

            // Load admin data
            admin.loadDashboard();
            admin.loadMedicines();
            admin.loadDoctors();
            admin.loadAppointments();

            // Setup form submissions
            document.getElementById('medicine-form').addEventListener('submit', handleMedicineSubmit);
            document.getElementById('doctor-form').addEventListener('submit', handleDoctorSubmit);
        });

        function handleMedicineSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const medicineData = {
                id: formData.get('id') || utils.generateId(),
                name: formData.get('name'),
                category: formData.get('category'),
                price: parseFloat(formData.get('price')),
                stock: parseInt(formData.get('stock')),
                description: formData.get('description')
            };

            try {
                if (formData.get('id')) {
                    admin.updateMedicine(medicineData);
                } else {
                    admin.addMedicine(medicineData);
                }
                admin.closeModal();
                admin.loadMedicines();
                notifications.showSuccess('Medicine saved successfully!');
            } catch (error) {
                notifications.showError(error.message);
            }
        }

        function handleDoctorSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const doctorData = {
                id: formData.get('id') || utils.generateId(),
                name: formData.get('name'),
                specialization: formData.get('specialization'),
                experience: parseInt(formData.get('experience')),
                phone: formData.get('phone'),
                photo: document.getElementById('doctor-photo').dataset.base64 || '',
                bio: formData.get('bio')
            };

            try {
                if (formData.get('id')) {
                    admin.updateDoctor(doctorData);
                } else {
                    admin.addDoctor(doctorData);
                }
                admin.closeModal();
                admin.loadDoctors();
                notifications.showSuccess('Doctor saved successfully!');
            } catch (error) {
                notifications.showError(error.message);
            }
        }
    </script>
</body>
</html>